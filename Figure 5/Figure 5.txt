Code for figure 5
